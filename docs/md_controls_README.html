<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MuddSub Software: Controls</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MuddSub Software
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Controls </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The controls package implements vehicle dynamics and the control systems for our AUV.</p>
<p>Maintainer: <a href="sisaacson@hmc.edu">Seth Isaacson</a>.</p>
<p>Status: Mostly working, but not well tested! This is a student project which is still in progress, so there may be some issues. The good news is we're all happy to help you fix them, as that will make it better for everyone!</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Vehicle Dynamics</h1>
<p>This robot operates in 12 degrees of freedom. Those are defined as follows:</p>
<p>The linear location of the robot is the x,y, and z positions. We use the north-east-down (NED) frame, which is common in underwater robotics. this means that x points forward, y points right, and z points down. These are commonly referred to as surge, sway, and heave respectively.</p>
<p>The angular location of the robot is the rotation about the x,y, and z axes. The x axis rotation is called "roll", which can be remembered because that's the axis you would spin around to make a plane do a barrel roll. The y axis rotation is called pitch (you pitch forwards and backwards). Finally, the most useful rotation is about the z axis, and called "yaw".</p>
<p>The other 6 degrees of freedom are the velocities about all of those axes.</p>
<p><img src="https://www.mdpi.com/sensors/sensors-15-07016/article_deploy/html/images/sensors-15-07016-g001.png" alt="axes" class="inline"/></p>
<p>The vehicle dynamics are taken from the classic text in marine vehicles, which is Thor Fossen's Handbook of Marine Craft Hydrodynamics and Motion Control (2011). The dynamics are implemented using the wonderful c++ <a href="https://github.com/ethz-adrl/control-toolbox">control toolbox</a>. This allows for easy linearization of the dynamics, as well as solving optimal control problems.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Control Systems</h1>
<p>Alfie uses three separate controllers. The first two are simple PID controllers which try to keep the robot flat in the water. So, one controller tries to keep pitch at 0, and the other tries to keep roll at 0. The third controller is an 8DOF LQR (linear quadratic regulator) which controls x,y,z,yaw, and those velocities.</p>
<p>For more details on PID, see: <a href="https://en.wikipedia.org/wiki/PID_controller">https://en.wikipedia.org/wiki/PID_controller</a></p>
<p>For details on LQR, see: <a href="https://www.mathworks.com/videos/state-space-part-4-what-is-lqr-control-1551955957637.html">https://www.mathworks.com/videos/state-space-part-4-what-is-lqr-control-1551955957637.html</a></p>
<p>Or, just ask Seth! I'm happy to explain more about controls and how you can get involved to anyone on the team.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Simulator</h1>
<p>Our simulator is based on <a href="http://www.irs.uji.es/uwsim/">uwsim</a>. To implement physics, we use our own model of vehicle dynamics. This needs work to be more realistic and incorporate more sensors, but it's a good start for modeling vehicle dynamics and control systems.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Running the simultator:</h2>
<p>You'll need UWSim to run the simulator. This is only tested on ROS melodic. Unfortunately UWSim is quite hard to install from source, and the only package manager I've found which installs it correctly is <code>apt</code>. So, if you're not on Ubuntu (or maybe some other Debian-esque linux), you may have a hard time.</p>
<p>Start the visual simulator: </p><div class="fragment"><div class="line">cd ~/catkin_ws/src/MuddSub/</div>
<div class="line">roscore</div>
<div class="line">rosrun uwsim uwsim </div>
</div><!-- fragment --><p>Launch vehicle dynamics (in another terminal): </p><div class="fragment"><div class="line">roslaunch controls DynamicSimulation.launch</div>
</div><!-- fragment --><p>Then, you can set the setpoint by publishing to the <code>/robot_setpoint</code> topic.</p>
<p>Currently, this is not a very streamlined experience, and you're unfortunately likely to run into bugs getting the simulator running. UWSim is great, but very picky, and this has only been tested on two machines. Please do not hesitate to email Seth with any questions, and I'm happy to help you debug!</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Known Limitations</h1>
<ul>
<li>Currently, the tuning abilility of the control systems is very limited, as it must be hardcoded. This will be a good project for a new member in the fall.</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Future Work</h1>
<ul>
<li>The major next steps is to switch from LQR control to linear model predictive control (MPC). While not strictly neccesary, it will be a fun project, and may be useful.</li>
<li>We also need better tuning and visualizing tools.</li>
<li>The simulator needs noise injection to be more realistic. We also need to add more of our sensors to the simulation. This will be more good projects for new members.</li>
<li>The simulator needs the robosub course modeled in using URDF (universal robot description format). This is, you guessed it, a great project for new members. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
